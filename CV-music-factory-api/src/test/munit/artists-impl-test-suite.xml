<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:munit="http://www.mulesoft.org/schema/mule/munit" xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xsi:schemaLocation="
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
		http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd">
	<munit:config name="artists-impl-test-suite.xml" />
	<munit:test name="artists-impl-add-test-suite" doc:id="afa10ad1-8e4d-44da-bbf2-dc56c04e524e" description="Test">
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when flow-ref" doc:id="feefea9d-2e28-46ca-842e-db1f9954ebbf" processor="flow-ref">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="e0c4170e-d156-418e-a2c5-63d3e8e995c8" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:variables >
						<munit-tools:variable key="getArtistResponse" value="#[{&quot;statusCode&quot;: &quot;200&quot;, &quot;message&quot;: &quot;SUCCESS&quot;, &quot;searchCriteria&quot;: &quot;[lastName: 'Hickman', firstName: 'Johnny', groupName: 'Telegraph Canyon', birthDate: '1988-01-29', ]&quot;, &quot;artists&quot;: []}]" mediaType="application/java" />
					</munit-tools:variables>
				</munit-tools:then-return>
			</munit-tools:mock-when>
			<munit-tools:mock-when doc:name="Mock when insert artists" doc:id="0cdff11a-70fe-46cf-92b0-140f69201191" processor="db:select">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="c6bbb7f1-7dd1-43d2-a479-aa02115e1dd5" attributeName="doc:id" />
				</munit-tools:with-attributes>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<munit:set-event doc:name="Post Artist Array" doc:id="58a282dd-f82d-4e33-b694-e7650407e048" >
				<munit:payload value='#[{&#10;  "artists": [&#10;    {&#10;      "groupName": "Telegraph Canyon",&#10;      "lastName": "Hickman",&#10;      "firstName": "Jill",&#10;      "dateOfBirth": "1988-01-29"&#10;    },&#10;    {&#10;      "groupName": "Telegraph Canyon",&#10;      "lastName": "Harrison",&#10;      "firstName": "Ted",&#10;      "mi": "B",&#10;      "dateOfBirth": "1982-03-21",&#10;"dateOfDeath": "2019-01-15"&#10;    }&#10;  ]&#10;}]' />
				<munit:variables >
					<munit:variable key="headerAttributes" value="{correlationId: '12345', clientId: '12345', clientSecret: '12345'}" mediaType="application/java" />
				</munit:variables>
			</munit:set-event>
			<flow-ref doc:name="impl-add-artists" doc:id="7c56f9ad-d0bc-4d71-ac4e-574cf9e87ac6" name="impl-add-artists"/>
		</munit:execution>
		<munit:validation >
			<munit-tools:assert-that doc:name="Assert that" doc:id="f4a31d34-9d93-48da-b410-966ea3bbe00b" expression="#[payload]" is="#[MunitTools::notNullValue()]" message="NOT NULL"/>
			<munit-tools:assert-that doc:name="Assert that added = 2" doc:id="7b753404-cff0-4101-b79e-0dc33e91de09" is="#[MunitTools::equalTo(2)]" expression="#[sizeOf(payload.results.addedArtists)]" message="added = 2"/>
		</munit:validation>
	</munit:test>
	<munit:test name="artists-impl-add-artists-duplicates-test" doc:id="811d5bb6-ff5e-412a-b7f5-83bca3f5de32" description="Test" >
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when flow-ref" doc:id="fce743c5-521f-451e-b7e9-30f70071e8ae" processor="flow-ref" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="e0c4170e-d156-418e-a2c5-63d3e8e995c8" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:variables >
						<munit-tools:variable key="getArtistResponse" value="#[{&quot;statusCode&quot;: &quot;200&quot;, &quot;message&quot;: &quot;SUCCESS&quot;, &quot;searchCriteria&quot;: &quot;[lastName: 'Hickman', firstName: 'Johnny', groupName: 'Telegraph Canyon', birthDate: '1988-01-29', ]&quot;, &quot;artists&quot;: [{&quot;artistId&quot;: 4,&quot;groupName&quot;: &quot;Telegraph Canyon&quot;,&quot;lastName&quot;: &quot;Hickman&quot;,&quot;firstName&quot;: &quot;Johnny&quot;,&quot;mi&quot;: &quot;&quot;,&quot;dateOfBirth&quot;: &quot;1988-01-29&quot;,&quot;dateOfDeath&quot;: &quot;&quot;}]}]" mediaType="application/java" />
					</munit-tools:variables>
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<munit:set-event doc:name="Post Artist Array" doc:id="d4f4120e-f263-4b8c-a828-121dc03fd1de" >
				<munit:payload value='#[{&#10;  "artists": [&#10;    {&#10;      "groupName": "Telegraph Canyon",&#10;      "lastName": "Hickman",&#10;      "firstName": "Jill",&#10;      "dateOfBirth": "1988-01-29"&#10;    },&#10;    {&#10;      "groupName": "Telegraph Canyon",&#10;      "lastName": "Harrison",&#10;      "firstName": "Ted",&#10;      "mi": "B",&#10;      "dateOfBirth": "1982-03-21",&#10;"dateOfDeath": "2019-01-15"&#10;    }&#10;  ]&#10;}]' />
				<munit:variables >
					<munit:variable key="headerAttributes" value="{correlationId: '12345', clientId: '12345', clientSecret: '12345'}" mediaType="application/java" />
				</munit:variables>
			</munit:set-event>
			<flow-ref doc:name="impl-add-artists" doc:id="8ae2d9c1-5ef1-4a81-ade6-7260d84bf7f2" name="impl-add-artists" />
		</munit:execution>
		<munit:validation >
			<munit-tools:assert-that doc:name="Assert that" doc:id="a6a486bb-e4ba-4868-998c-09ec2c68e039" message="NOT NULL" expression="#[payload]" is="#[MunitTools::notNullValue()]" />
			<munit-tools:assert-that doc:name="Assert that added = " doc:id="91fa26cc-1ef7-4fdc-a76c-2eca9b3ce467" message="duplicates = 2" expression="#[sizeOf(payload.results.duplicatedArtists)]" is="#[MunitTools::equalTo(2)]" />
		</munit:validation>
	</munit:test>


</mule>
